Index: Client/src/main/java/shared/dto/CommandDTO.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package shared.dto;\r\n\r\nimport java.io.Serializable;\r\nimport java.time.LocalDate;\r\nimport java.util.HashMap;\r\nimport java.util.Map;\r\n\r\npublic class CommandDTO implements Serializable {\r\n\r\n    private static final long serialVersionUID = 1L;\r\n\r\n    public enum Action {\r\n        // AUTH\r\n        REGISTER,\r\n        LOGIN,\r\n        LOGOUT,\r\n\r\n        // PUBLIC/PATIENT\r\n        GET_DOCTORS,\r\n        GET_DOCTOR_SCHEDULE,\r\n        GET_AVAILABLE_SLOTS,\r\n        GET_SPECIALIZATIONS,\r\n        GET_MEDICAL_SERVICES,\r\n\r\n        // APPOINTMENTS\r\n        BOOK_APPOINTMENT,\r\n        CANCEL_APPOINTMENT,\r\n        GET_MY_APPOINTMENTS,          // patient\r\n        GET_PATIENT_DASHBOARD,        // patient dashboard summary\r\n        GET_DOCTOR_APPOINTMENTS,      // doctor/manager\r\n        APPROVE_APPOINTMENT,          // admin\r\n        MARK_APPOINTMENT_DONE,        // doctor/manager (optional)\r\n\r\n        // MEDICAL RECORD\r\n        GET_MY_MEDICAL_RECORD,        // patient\r\n        GET_PATIENT_MEDICAL_RECORD,   // doctor/manager/admin\r\n        ADD_MEDICAL_RECORD_ENTRY,     // doctor/manager\r\n\r\n        // FEEDBACK\r\n        SEND_FEEDBACK,\r\n        GET_FEEDBACK_FOR_DOCTOR,      // optional\r\n\r\n        // ADMIN: USERS\r\n        ADMIN_LIST_USERS,\r\n        ADMIN_CREATE_USER,\r\n        ADMIN_UPDATE_USER,\r\n        ADMIN_DELETE_USER,\r\n\r\n        // MANAGER/ADMIN: STATS\r\n        GET_STATS\r\n    }\r\n\r\n    private Action action;\r\n\r\n    // Who is requesting this action (server uses it for permissions)\r\n    private Long requesterUserId;\r\n\r\n    // Generic key-value payload\r\n    private Map<String, Object> data = new HashMap<>();\r\n\r\n    public CommandDTO(Action action) {\r\n        this.action = action;\r\n    }\r\n\r\n    public CommandDTO(Action action, Long requesterUserId) {\r\n        this.action = action;\r\n        this.requesterUserId = requesterUserId;\r\n    }\r\n\r\n    public CommandDTO(Action action, Long requesterUserId, Map<String, Object> data) {\r\n        this.action = action;\r\n        this.requesterUserId = requesterUserId;\r\n        if (data != null) this.data = data;\r\n    }\r\n\r\n    public Action getAction() { return action; }\r\n    public Long getRequesterUserId() { return requesterUserId; }\r\n    public Map<String, Object> getData() { return data; }\r\n\r\n    // Fluent helper\r\n    public CommandDTO put(String key, Object value) {\r\n        data.put(key, value);\r\n        return this;\r\n    }\r\n\r\n    // Typed getters (optional but helpful)\r\n    public String getString(String key) { return (String) data.get(key); }\r\n    public LocalDate getDate(String key) { return (LocalDate) data.get(key); }\r\n    public Long getLong(String key) { return (Long) data.get(key); }\r\n    public Integer getInt(String key) { return (Integer) data.get(key); }\r\n    public Boolean getBool(String key) { return (Boolean) data.get(key); }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/Client/src/main/java/shared/dto/CommandDTO.java b/Client/src/main/java/shared/dto/CommandDTO.java
--- a/Client/src/main/java/shared/dto/CommandDTO.java	(revision 56bdb2df2e1fee6f017ba5aa94d837f9c6939598)
+++ b/Client/src/main/java/shared/dto/CommandDTO.java	(date 1767701564516)
@@ -24,6 +24,7 @@
 
         // APPOINTMENTS
         BOOK_APPOINTMENT,
+        UPDATE_APPOINTMENT,
         CANCEL_APPOINTMENT,
         GET_MY_APPOINTMENTS,          // patient
         GET_PATIENT_DASHBOARD,        // patient dashboard summary
Index: Server/src/main/java/server/controller/HospitalController.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package server.controller;\r\n\r\nimport shared.common.Response;\r\nimport shared.dto.CommandDTO;\r\nimport ocsf.server.ConnectionToClient;\r\n\r\n\r\npublic class HospitalController {\r\n\r\n    private final AuthController authController;\r\n    private final DoctorController doctorController;\r\n    private final AppointmentController appointmentController;\r\n    private final MedicalRecordController medicalRecordController;\r\n    private final FeedbackController feedbackController;\r\n    private final AdminController adminController;\r\n    private final StatsController statsController;\r\n    private final PublicController publicController;\r\n    private final PatientDashboardController patientDashboardController;\r\n\r\n    public HospitalController() {\r\n        this.authController = new AuthController();\r\n        this.doctorController = new DoctorController();\r\n        this.appointmentController = new AppointmentController();\r\n        this.medicalRecordController = new MedicalRecordController();\r\n        this.feedbackController = new FeedbackController();\r\n        this.adminController = new AdminController();\r\n        this.statsController = new StatsController();\r\n        this.publicController = new PublicController();\r\n        this.patientDashboardController = new PatientDashboardController();\r\n    }\r\n\r\n    /**\r\n     * Main dispatcher for ALL client commands.\r\n     */\r\n    public Response handle(CommandDTO command, ConnectionToClient client) {\r\n\r\n        if (command == null || command.getAction() == null) {\r\n            return Response.error(\"INVALID_COMMAND\", \"Command or action is null\");\r\n        }\r\n\r\n        try {\r\n            return switch (command.getAction()) {\r\n\r\n                // =====================\r\n                // AUTH\r\n                // =====================\r\n                case LOGIN ->\r\n                        authController.login(command);\r\n\r\n                case REGISTER ->\r\n                        authController.registerPatient(command);\r\n\r\n                case LOGOUT ->\r\n                        authController.logout(command);\r\n\r\n                // =====================\r\n                // PUBLIC / PATIENT\r\n                // =====================\r\n                case GET_DOCTORS ->\r\n                        doctorController.getDoctors();\r\n\r\n                case GET_DOCTOR_SCHEDULE ->\r\n                        doctorController.getDoctorSchedule(command);\r\n\r\n                case GET_AVAILABLE_SLOTS ->\r\n                        appointmentController.getAvailableSlots(command);\r\n\r\n                case GET_SPECIALIZATIONS ->\r\n                        publicController.getSpecializations();\r\n\r\n                case GET_MEDICAL_SERVICES ->\r\n                        publicController.getMedicalServices();\r\n\r\n                case GET_PATIENT_DASHBOARD ->\r\n                        patientDashboardController.getDashboard(command);\r\n\r\n                // =====================\r\n                // APPOINTMENTS\r\n                // =====================\r\n                case BOOK_APPOINTMENT ->\r\n                        appointmentController.bookAppointment(command);\r\n\r\n                case CANCEL_APPOINTMENT ->\r\n                        appointmentController.cancelAppointment(command);\r\n\r\n                case APPROVE_APPOINTMENT ->\r\n                        appointmentController.approveAppointment(command);\r\n\r\n                case MARK_APPOINTMENT_DONE ->\r\n                        appointmentController.markAppointmentDone(command);\r\n\r\n                case GET_MY_APPOINTMENTS,\r\n                     GET_DOCTOR_APPOINTMENTS ->\r\n                        Response.error(\"NOT_IMPLEMENTED\", \"GET_APPOINTMENTS not implemented yet\");\r\n\r\n                // =====================\r\n                // MEDICAL RECORD\r\n                // =====================\r\n                case ADD_MEDICAL_RECORD_ENTRY ->\r\n                        medicalRecordController.addMedicalRecordEntry(command);\r\n\r\n                case GET_MY_MEDICAL_RECORD ->\r\n                        medicalRecordController.getMyMedicalRecord(command);\r\n\r\n                case GET_PATIENT_MEDICAL_RECORD ->\r\n                        medicalRecordController.getPatientMedicalRecord(command);\r\n\r\n                // =====================\r\n                // FEEDBACK\r\n                // =====================\r\n                case SEND_FEEDBACK ->\r\n                        feedbackController.sendFeedback(command);\r\n\r\n                // =====================\r\n                // ADMIN\r\n                // =====================\r\n                case ADMIN_CREATE_USER ->\r\n                        adminController.createUser(command);\r\n\r\n                case ADMIN_UPDATE_USER ->\r\n                        adminController.updateUser(command);\r\n\r\n                case ADMIN_DELETE_USER ->\r\n                        adminController.deleteUser(command);\r\n\r\n                case ADMIN_LIST_USERS ->\r\n                        adminController.listUsers();\r\n\r\n                // =====================\r\n                // MANAGER / ADMIN\r\n                // =====================\r\n                case GET_STATS ->\r\n                        statsController.getStats(command);\r\n\r\n                // =====================\r\n                // DEFAULT\r\n                // =====================\r\n                default ->\r\n                        Response.error(\"UNKNOWN_ACTION\", \"Unknown action: \" + command.getAction());\r\n            };\r\n\r\n        } catch (Exception e) {\r\n            return Response.error(\"SERVER_ERROR\", e.getMessage());\r\n        }\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/Server/src/main/java/server/controller/HospitalController.java b/Server/src/main/java/server/controller/HospitalController.java
--- a/Server/src/main/java/server/controller/HospitalController.java	(revision 56bdb2df2e1fee6f017ba5aa94d837f9c6939598)
+++ b/Server/src/main/java/server/controller/HospitalController.java	(date 1767701564518)
@@ -80,6 +80,9 @@
                 case BOOK_APPOINTMENT ->
                         appointmentController.bookAppointment(command);
 
+                case UPDATE_APPOINTMENT ->
+                        appointmentController.updateAppointment(command);
+
                 case CANCEL_APPOINTMENT ->
                         appointmentController.cancelAppointment(command);
 
Index: Client/src/main/resources/styles/patient_dashboard.css
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>.dashboard-page {\r\n    -fx-background-color: #eef2f6;\r\n    -fx-font-family: \"Inter\", \"Segoe UI\", sans-serif;\r\n}\r\n\r\n.dashboard-scroll {\r\n    -fx-background-color: transparent;\r\n}\r\n\r\n.dashboard-root {\r\n    -fx-padding: 20 32 40 32;\r\n}\r\n\r\n.dashboard-topbar {\r\n    -fx-background-color: #ffffff;\r\n    -fx-background-radius: 16;\r\n    -fx-padding: 12 18;\r\n    -fx-effect: dropshadow(gaussian, rgba(30, 90, 180, 0.18), 14, 0.2, 0, 4);\r\n}\r\n\r\n.brand-icon {\r\n    -fx-background-color: #dbeafe;\r\n    -fx-background-radius: 8;\r\n    -fx-padding: 4 8;\r\n    -fx-text-fill: #1d75d8;\r\n    -fx-font-weight: 700;\r\n}\r\n\r\n.brand-text {\r\n    -fx-text-fill: #0f172a;\r\n    -fx-font-size: 16px;\r\n    -fx-font-weight: 700;\r\n}\r\n\r\n.nav-button {\r\n    -fx-background-color: transparent;\r\n    -fx-text-fill: #475569;\r\n    -fx-font-size: 12px;\r\n    -fx-font-weight: 600;\r\n    -fx-background-radius: 14;\r\n    -fx-padding: 6 12;\r\n    -fx-border-color: transparent;\r\n    -fx-border-radius: 14;\r\n    -fx-background-insets: 0;\r\n    -fx-border-insets: 0;\r\n    -fx-effect: null;\r\n    -fx-focus-color: transparent;\r\n    -fx-faint-focus-color: transparent;\r\n}\r\n\r\n.nav-active {\r\n    -fx-text-fill: #1d75d8;\r\n    -fx-background-color: #e6f0ff;\r\n    -fx-background-radius: 14;\r\n    -fx-padding: 6 12;\r\n    -fx-border-color: #cfe1ff;\r\n    -fx-border-radius: 14;\r\n    -fx-border-width: 1;\r\n    -fx-background-insets: 0;\r\n    -fx-border-insets: 0;\r\n    -fx-effect: null;\r\n}\r\n\r\n.nav-button:focused {\r\n    -fx-background-insets: 0;\r\n    -fx-border-insets: 0;\r\n    -fx-effect: null;\r\n    -fx-focus-color: transparent;\r\n    -fx-faint-focus-color: transparent;\r\n}\r\n\r\n.nav-active:focused {\r\n    -fx-background-insets: 0;\r\n    -fx-border-insets: 0;\r\n    -fx-effect: null;\r\n    -fx-focus-color: transparent;\r\n    -fx-faint-focus-color: transparent;\r\n}\r\n\r\n.nav-button:armed,\r\n.nav-button:hover {\r\n    -fx-background-insets: 0;\r\n    -fx-border-insets: 0;\r\n    -fx-effect: null;\r\n}\r\n\r\n.nav-active:armed,\r\n.nav-active:hover {\r\n    -fx-background-insets: 0;\r\n    -fx-border-insets: 0;\r\n    -fx-effect: null;\r\n}\r\n\r\n.profile-name {\r\n    -fx-text-fill: #0f172a;\r\n    -fx-font-size: 12px;\r\n    -fx-font-weight: 700;\r\n}\r\n\r\n.profile-role {\r\n    -fx-text-fill: #64748b;\r\n    -fx-font-size: 11px;\r\n}\r\n\r\n.profile-avatar {\r\n    -fx-background-color: #e6f0ff;\r\n    -fx-background-radius: 999;\r\n    -fx-pref-width: 36;\r\n    -fx-pref-height: 36;\r\n}\r\n\r\n.profile-initials {\r\n    -fx-text-fill: #0f172a;\r\n    -fx-font-weight: 700;\r\n}\r\n\r\n.welcome-title {\r\n    -fx-text-fill: #0f172a;\r\n    -fx-font-size: 24px;\r\n    -fx-font-weight: 800;\r\n}\r\n\r\n.welcome-subtitle {\r\n    -fx-text-fill: #64748b;\r\n    -fx-font-size: 12px;\r\n}\r\n\r\n.card {\r\n    -fx-background-color: #ffffff;\r\n    -fx-background-radius: 16;\r\n    -fx-padding: 16;\r\n    -fx-effect: dropshadow(gaussian, rgba(30, 90, 180, 0.10), 12, 0.2, 0, 4);\r\n    -fx-border-color: #e2ecff;\r\n    -fx-border-radius: 16;\r\n}\r\n\r\n.section-title {\r\n    -fx-text-fill: #0f172a;\r\n    -fx-font-size: 15px;\r\n    -fx-font-weight: 700;\r\n}\r\n\r\n.section-icon {\r\n    -fx-text-fill: #1d75d8;\r\n    -fx-font-size: 14px;\r\n    -fx-font-weight: 700;\r\n    -fx-background-color: #e6f0ff;\r\n    -fx-background-radius: 8;\r\n    -fx-padding: 4 6;\r\n}\r\n\r\n.doctor-avatar-large {\r\n    -fx-background-color: #e6f0ff;\r\n    -fx-background-radius: 12;\r\n    -fx-pref-width: 90;\r\n    -fx-pref-height: 90;\r\n}\r\n\r\n.doctor-initials {\r\n    -fx-text-fill: #0f172a;\r\n    -fx-font-size: 20px;\r\n    -fx-font-weight: 700;\r\n}\r\n\r\n.doctor-name {\r\n    -fx-text-fill: #0f172a;\r\n    -fx-font-size: 16px;\r\n    -fx-font-weight: 700;\r\n}\r\n\r\n.doctor-subtitle {\r\n    -fx-text-fill: #1d75d8;\r\n    -fx-font-size: 12px;\r\n    -fx-font-weight: 600;\r\n}\r\n\r\n.info-chip {\r\n    -fx-background-color: #f0f6ff;\r\n    -fx-background-radius: 12;\r\n    -fx-padding: 8 12;\r\n}\r\n\r\n.chip-label {\r\n    -fx-text-fill: #64748b;\r\n    -fx-font-size: 11px;\r\n}\r\n\r\n.chip-value {\r\n    -fx-text-fill: #0f172a;\r\n    -fx-font-size: 12px;\r\n    -fx-font-weight: 700;\r\n}\r\n\r\n.summary-row {\r\n    -fx-alignment: center-left;\r\n}\r\n\r\n.pill {\r\n    -fx-background-color: #e6f0ff;\r\n    -fx-background-radius: 999;\r\n    -fx-text-fill: #0f172a;\r\n    -fx-font-size: 11px;\r\n    -fx-font-weight: 700;\r\n    -fx-padding: 4 10;\r\n}\r\n\r\n.pill-danger {\r\n    -fx-background-color: #fde8e8;\r\n    -fx-text-fill: #b91c1c;\r\n}\r\n\r\n.pill-warning {\r\n    -fx-background-color: #fef3c7;\r\n    -fx-text-fill: #92400e;\r\n}\r\n\r\n.tag {\r\n    -fx-background-color: #fde8e8;\r\n    -fx-text-fill: #b91c1c;\r\n    -fx-background-radius: 999;\r\n    -fx-font-size: 11px;\r\n    -fx-font-weight: 700;\r\n    -fx-padding: 4 10;\r\n}\r\n\r\n.tag-warning {\r\n    -fx-background-color: #fef3c7;\r\n    -fx-text-fill: #92400e;\r\n    -fx-background-radius: 999;\r\n    -fx-font-size: 11px;\r\n    -fx-font-weight: 700;\r\n    -fx-padding: 4 10;\r\n}\r\n\r\n.history-item {\r\n    -fx-padding: 12 0;\r\n    -fx-border-color: #e2e8f0;\r\n    -fx-border-width: 0 0 1 0;\r\n}\r\n\r\n.history-title {\r\n    -fx-text-fill: #0f172a;\r\n    -fx-font-size: 13px;\r\n    -fx-font-weight: 700;\r\n}\r\n\r\n.muted-text {\r\n    -fx-text-fill: #64748b;\r\n    -fx-font-size: 11px;\r\n}\r\n\r\n.primary-button {\r\n    -fx-background-color: #1d75d8;\r\n    -fx-text-fill: #ffffff;\r\n    -fx-font-size: 12px;\r\n    -fx-font-weight: 700;\r\n    -fx-background-radius: 12;\r\n    -fx-padding: 8 16;\r\n    -fx-min-width: 140;\r\n}\r\n\r\n.primary-button:hover {\r\n    -fx-background-color: #165ca8;\r\n}\r\n\r\n.ghost-button {\r\n    -fx-background-color: transparent;\r\n    -fx-text-fill: #475569;\r\n    -fx-font-size: 11px;\r\n    -fx-font-weight: 600;\r\n    -fx-border-color: #e2e8f0;\r\n    -fx-border-radius: 10;\r\n    -fx-background-radius: 10;\r\n    -fx-padding: 6 12;\r\n}\r\n\r\n.danger-button {\r\n    -fx-background-color: #fee2e2;\r\n    -fx-text-fill: #b91c1c;\r\n    -fx-font-size: 11px;\r\n    -fx-font-weight: 700;\r\n    -fx-background-radius: 10;\r\n    -fx-padding: 6 12;\r\n}\r\n\r\n.link-button {\r\n    -fx-background-color: transparent;\r\n    -fx-text-fill: #1d75d8;\r\n    -fx-font-size: 11px;\r\n    -fx-font-weight: 600;\r\n}\r\n\r\n.status-label {\r\n    -fx-text-fill: #64748b;\r\n    -fx-font-size: 11px;\r\n}\r\n\r\n.nav-button nav-active {\r\n    -fx-background-color: #1d75d8;\r\n    -fx-text-fill: #ffffff;\r\n    -fx-font-size: 12px;\r\n    -fx-font-weight: 700;\r\n    -fx-background-radius: 12;\r\n    -fx-padding: 8 16;\r\n    -fx-min-width: 140;\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/Client/src/main/resources/styles/patient_dashboard.css b/Client/src/main/resources/styles/patient_dashboard.css
--- a/Client/src/main/resources/styles/patient_dashboard.css	(revision 56bdb2df2e1fee6f017ba5aa94d837f9c6939598)
+++ b/Client/src/main/resources/styles/patient_dashboard.css	(date 1767701564517)
@@ -304,3 +304,115 @@
     -fx-padding: 8 16;
     -fx-min-width: 140;
 }
+
+/* =========================================
+   FEEDBACK & DIALOG STYLES
+   ========================================= */
+
+/* Butonul mic de Feedback din lista de istoric */
+.secondary-button {
+    -fx-background-color: #eff6ff; /* Albastru foarte deschis */
+    -fx-text-fill: #1d75d8;        /* Albastru principal */
+    -fx-font-size: 11px;
+    -fx-font-weight: 700;
+    -fx-background-radius: 8;
+    -fx-padding: 5 12;
+    -fx-cursor: hand;
+    -fx-border-color: #dbeafe;
+    -fx-border-radius: 8;
+}
+
+.secondary-button:hover {
+    -fx-background-color: #dbeafe;
+    -fx-border-color: #bfdbfe;
+}
+
+.secondary-button:pressed {
+    -fx-background-color: #bfdbfe;
+}
+
+/* Stiluri pentru Fereastra de Dialog (Pop-up) */
+.dialog-pane {
+    -fx-background-color: #ffffff;
+    -fx-font-family: "Inter", "Segoe UI", sans-serif;
+    -fx-padding: 0;
+}
+
+/* Header-ul dialogului */
+.dialog-pane .header-panel {
+    -fx-background-color: #ffffff;
+    -fx-padding: 20 20 10 20;
+}
+
+.dialog-pane .header-panel .label {
+    -fx-text-fill: #0f172a;
+    -fx-font-size: 16px;
+    -fx-font-weight: 700;
+}
+
+/* Zona de continut a dialogului */
+.dialog-pane .content {
+    -fx-padding: 10 20 20 20;
+}
+
+/* Input-urile din dialog (TextArea si ComboBox) */
+.text-area {
+    -fx-background-color: #ffffff;
+    -fx-text-fill: #0f172a;
+    -fx-prompt-text-fill: #94a3b8;
+    -fx-border-color: #e2e8f0;
+    -fx-border-radius: 8;
+    -fx-background-radius: 8;
+    -fx-padding: 4;
+}
+
+.text-area .content {
+    -fx-background-color: #ffffff;
+    -fx-background-radius: 8;
+}
+
+.text-area:focused {
+    -fx-border-color: #1d75d8;
+    -fx-effect: dropshadow(gaussian, rgba(29, 117, 216, 0.15), 4, 0, 0, 0);
+}
+
+.combo-box {
+    -fx-background-color: #ffffff;
+    -fx-border-color: #e2e8f0;
+    -fx-border-radius: 8;
+    -fx-background-radius: 8;
+    -fx-padding: 2 6;
+}
+
+.combo-box:focused {
+    -fx-border-color: #1d75d8;
+}
+
+.combo-box .list-cell {
+    -fx-text-fill: #0f172a;
+}
+
+/* Butoanele de jos din dialog (Trimite / Anuleaza) */
+.dialog-pane .button-bar .button {
+    -fx-background-color: transparent;
+    -fx-text-fill: #64748b;
+    -fx-font-weight: 600;
+    -fx-background-radius: 8;
+    -fx-cursor: hand;
+}
+
+.dialog-pane .button-bar .button:hover {
+    -fx-background-color: #f1f5f9;
+    -fx-text-fill: #0f172a;
+}
+
+/* Butonul "Trimite" (care este default) */
+.dialog-pane .button-bar .button:default {
+    -fx-background-color: #1d75d8;
+    -fx-text-fill: #ffffff;
+    -fx-font-weight: 700;
+}
+
+.dialog-pane .button-bar .button:default:hover {
+    -fx-background-color: #165ca8;
+}
Index: Server/src/main/java/shared/dto/CommandDTO.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package shared.dto;\r\n\r\nimport java.io.Serializable;\r\nimport java.time.LocalDate;\r\nimport java.util.HashMap;\r\nimport java.util.Map;\r\n\r\npublic class CommandDTO implements Serializable {\r\n\r\n    private static final long serialVersionUID = 1L;\r\n\r\n    public enum Action {\r\n        // AUTH\r\n        REGISTER,\r\n        LOGIN,\r\n        LOGOUT,\r\n\r\n        // PUBLIC/PATIENT\r\n        GET_DOCTORS,\r\n        GET_DOCTOR_SCHEDULE,\r\n        GET_AVAILABLE_SLOTS,\r\n        GET_SPECIALIZATIONS,\r\n        GET_MEDICAL_SERVICES,\r\n\r\n        // APPOINTMENTS\r\n        BOOK_APPOINTMENT,\r\n        CANCEL_APPOINTMENT,\r\n        GET_MY_APPOINTMENTS,          // patient\r\n        GET_PATIENT_DASHBOARD,        // patient dashboard summary\r\n        GET_DOCTOR_APPOINTMENTS,      // doctor/manager\r\n        APPROVE_APPOINTMENT,          // admin\r\n        MARK_APPOINTMENT_DONE,        // doctor/manager (optional)\r\n\r\n        // MEDICAL RECORD\r\n        GET_MY_MEDICAL_RECORD,        // patient\r\n        GET_PATIENT_MEDICAL_RECORD,   // doctor/manager/admin\r\n        ADD_MEDICAL_RECORD_ENTRY,     // doctor/manager\r\n\r\n        // FEEDBACK\r\n        SEND_FEEDBACK,\r\n        GET_FEEDBACK_FOR_DOCTOR,      // optional\r\n\r\n        // ADMIN: USERS\r\n        ADMIN_LIST_USERS,\r\n        ADMIN_CREATE_USER,\r\n        ADMIN_UPDATE_USER,\r\n        ADMIN_DELETE_USER,\r\n\r\n        // MANAGER/ADMIN: STATS\r\n        GET_STATS\r\n    }\r\n\r\n    private Action action;\r\n\r\n    // Who is requesting this action (server uses it for permissions)\r\n    private Long requesterUserId;\r\n\r\n    // Generic key-value payload\r\n    private Map<String, Object> data = new HashMap<>();\r\n\r\n    public CommandDTO(Action action) {\r\n        this.action = action;\r\n    }\r\n\r\n    public CommandDTO(Action action, Long requesterUserId) {\r\n        this.action = action;\r\n        this.requesterUserId = requesterUserId;\r\n    }\r\n\r\n    public CommandDTO(Action action, Long requesterUserId, Map<String, Object> data) {\r\n        this.action = action;\r\n        this.requesterUserId = requesterUserId;\r\n        if (data != null) this.data = data;\r\n    }\r\n\r\n    public Action getAction() { return action; }\r\n    public Long getRequesterUserId() { return requesterUserId; }\r\n    public Map<String, Object> getData() { return data; }\r\n\r\n    // Fluent helper\r\n    public CommandDTO put(String key, Object value) {\r\n        data.put(key, value);\r\n        return this;\r\n    }\r\n\r\n    // Typed getters (optional but helpful)\r\n    public String getString(String key) { return (String) data.get(key); }\r\n    public LocalDate getDate(String key) { return (LocalDate) data.get(key); }\r\n    public Long getLong(String key) { return (Long) data.get(key); }\r\n    public Integer getInt(String key) { return (Integer) data.get(key); }\r\n    public Boolean getBool(String key) { return (Boolean) data.get(key); }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/Server/src/main/java/shared/dto/CommandDTO.java b/Server/src/main/java/shared/dto/CommandDTO.java
--- a/Server/src/main/java/shared/dto/CommandDTO.java	(revision 56bdb2df2e1fee6f017ba5aa94d837f9c6939598)
+++ b/Server/src/main/java/shared/dto/CommandDTO.java	(date 1767701564519)
@@ -24,6 +24,7 @@
 
         // APPOINTMENTS
         BOOK_APPOINTMENT,
+        UPDATE_APPOINTMENT,
         CANCEL_APPOINTMENT,
         GET_MY_APPOINTMENTS,          // patient
         GET_PATIENT_DASHBOARD,        // patient dashboard summary
Index: Client/src/main/java/com/hospital_management/client/presenter/auth/LoginPresenter.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.hospital_management.client.presenter.auth;\r\n\r\nimport com.hospital_management.client.app.AppScene;\r\nimport com.hospital_management.client.app.SceneNavigator;\r\nimport com.hospital_management.client.network.ClientSession;\r\nimport com.hospital_management.client.view.auth.LoginView;\r\nimport javafx.application.Platform;\r\nimport shared.common.Request;\r\nimport shared.common.RequestType;\r\nimport shared.common.Response;\r\nimport shared.dto.CommandDTO;\r\nimport shared.dto.LoginResponseDTO;\r\nimport shared.dto.UserDTO;\r\n\r\npublic class LoginPresenter {\r\n\r\n    private final LoginView view;\r\n\r\n    public LoginPresenter(LoginView view) {\r\n        this.view = view;\r\n    }\r\n\r\n    public void onLogin(String emailRaw, String passwordRaw) {\r\n        String email = safe(emailRaw);\r\n        String password = passwordRaw == null ? \"\" : passwordRaw;\r\n\r\n        if (!validateLogin(email, password)) {\r\n            return;\r\n        }\r\n\r\n        if (!ClientSession.getInstance().ensureConnected()) {\r\n            view.setError(\"Nu există conexiune la server!\");\r\n            return;\r\n        }\r\n\r\n        CommandDTO cmd = new CommandDTO(CommandDTO.Action.LOGIN)\r\n                .put(\"email\", email)\r\n                .put(\"password\", password);\r\n\r\n        Request req = new Request(cmd);\r\n        req.setType(RequestType.COMMAND);\r\n\r\n        view.setBusy(true);\r\n        view.setInfo(\"Se autentifică...\");\r\n\r\n        ClientSession.getInstance().getClient().setOnResponseReceived(this::handleResponse);\r\n        ClientSession.getInstance().getClient().sendRequest(req);\r\n    }\r\n\r\n    private void handleResponse(Response response) {\r\n        Platform.runLater(() -> {\r\n            view.setBusy(false);\r\n\r\n            if (response.getStatus() != Response.Status.OK) {\r\n                view.setError(\"Eroare: \" + response.getMessage());\r\n                return;\r\n            }\r\n\r\n            LoginResponseDTO data = (LoginResponseDTO) response.getData();\r\n\r\n            UserDTO user = new UserDTO(\r\n                    data.getUserId(),\r\n                    data.getFirstName(),\r\n                    data.getLastName(),\r\n                    data.getEmail(),\r\n                    data.getRole(),\r\n                    data.getPatientId(),\r\n                    data.getDoctorId()\r\n            );\r\n            System.out.println(user);\r\n            ClientSession.getInstance().setLoggedUser(user);\r\n\r\n            // Navigare după rol\r\n            switch (data.getRole()) {\r\n                case \"ADMIN\" -> SceneNavigator.navigateTo(AppScene.ADMIN_DASHBOARD);\r\n                case \"DOCTOR\" -> SceneNavigator.navigateTo(AppScene.DOCTOR_DASHBOARD);\r\n                case \"MANAGER\" -> SceneNavigator.navigateTo(AppScene.MANAGER_DASHBOARD);\r\n                case \"PATIENT\" -> SceneNavigator.navigateTo(AppScene.PATIENT_DASHBOARD);\r\n                default -> SceneNavigator.navigateTo(AppScene.PUBLIC);\r\n            }\r\n        });\r\n    }\r\n\r\n    public void onGoToRegister() {\r\n        SceneNavigator.navigateTo(AppScene.REGISTER);\r\n    }\r\n\r\n    private String safe(String s) {\r\n        return s == null ? \"\" : s.trim();\r\n    }\r\n\r\n    private boolean validateLogin(String email, String password) {\r\n        if (email.isEmpty() || password.isEmpty()) {\r\n            view.setError(\"Introduceti email si parola!\");\r\n            return false;\r\n        }\r\n        if (email.length() > 255 || password.length() > 128) {\r\n            view.setError(\"Datele introduse sunt prea lungi.\");\r\n            return false;\r\n        }\r\n        if (!email.contains(\"@\") || !email.contains(\".\")) {\r\n            view.setError(\"Email invalid!\");\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n}\r\n\r\n\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/Client/src/main/java/com/hospital_management/client/presenter/auth/LoginPresenter.java b/Client/src/main/java/com/hospital_management/client/presenter/auth/LoginPresenter.java
--- a/Client/src/main/java/com/hospital_management/client/presenter/auth/LoginPresenter.java	(revision 56bdb2df2e1fee6f017ba5aa94d837f9c6939598)
+++ b/Client/src/main/java/com/hospital_management/client/presenter/auth/LoginPresenter.java	(date 1767701564514)
@@ -72,10 +72,10 @@
 
             // Navigare după rol
             switch (data.getRole()) {
-                case "ADMIN" -> SceneNavigator.navigateTo(AppScene.ADMIN_DASHBOARD);
-                case "DOCTOR" -> SceneNavigator.navigateTo(AppScene.DOCTOR_DASHBOARD);
-                case "MANAGER" -> SceneNavigator.navigateTo(AppScene.MANAGER_DASHBOARD);
-                case "PATIENT" -> SceneNavigator.navigateTo(AppScene.PATIENT_DASHBOARD);
+                case "ADMIN" -> SceneNavigator.navigateToFresh(AppScene.ADMIN_DASHBOARD);
+                case "DOCTOR" -> SceneNavigator.navigateToFresh(AppScene.DOCTOR_DASHBOARD);
+                case "MANAGER" -> SceneNavigator.navigateToFresh(AppScene.MANAGER_DASHBOARD);
+                case "PATIENT" -> SceneNavigator.navigateToFresh(AppScene.PATIENT_DASHBOARD);
                 default -> SceneNavigator.navigateTo(AppScene.PUBLIC);
             }
         });
Index: Client/src/main/java/com/hospital_management/client/view/patient/PatientDashboardView.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.hospital_management.client.view.patient;\r\n\r\nimport com.hospital_management.client.app.AppScene;\r\nimport com.hospital_management.client.app.SceneNavigator;\r\nimport com.hospital_management.client.network.ClientSession;\r\nimport com.hospital_management.client.presenter.patient.PatientDashboardPresenter;\r\nimport javafx.fxml.FXML;\r\nimport javafx.scene.Node;\r\nimport javafx.scene.control.Label;\r\nimport javafx.scene.layout.FlowPane;\r\nimport javafx.scene.layout.VBox;\r\nimport shared.dto.AppointmentDTO;\r\nimport shared.dto.PatientDashboardDTO;\r\nimport shared.dto.PatientProfileDTO;\r\nimport shared.dto.UserDTO;\r\n\r\nimport java.time.format.DateTimeFormatter;\r\nimport java.util.List;\r\n\r\npublic class PatientDashboardView {\r\n\r\n    @FXML private Label userNameLabel;\r\n    @FXML private Label roleLabel;\r\n    @FXML private Label initialsLabel;\r\n    @FXML private Label welcomeLabel;\r\n    @FXML private Label nextDoctorName;\r\n    @FXML private Label nextDoctorSpecialization;\r\n    @FXML private Label nextDateLabel;\r\n    @FXML private Label nextTimeLabel;\r\n    @FXML private Label nextDoctorInitials;\r\n    @FXML private Label bloodTypeLabel;\r\n    @FXML private Label weightLabel;\r\n    @FXML private Label heightLabel;\r\n    @FXML private FlowPane allergiesPane;\r\n    @FXML private FlowPane conditionsPane;\r\n    @FXML private VBox historyContainer;\r\n    @FXML private Label statusLabel;\r\n\r\n    private PatientDashboardPresenter presenter;\r\n\r\n    @FXML\r\n    public void initialize() {\r\n        presenter = new PatientDashboardPresenter(this);\r\n        statusLabel.setText(\"\");\r\n        renderUserHeader(ClientSession.getInstance().getLoggedUser());\r\n        presenter.loadDashboard();\r\n    }\r\n\r\n    @FXML\r\n    public void onNavHomeClick() {\r\n        SceneNavigator.navigateTo(AppScene.PATIENT_DASHBOARD);\r\n    }\r\n\r\n    @FXML\r\n    public void onNavAppointmentsClick() {\r\n        SceneNavigator.navigateTo(AppScene.APPOINTMENT_BOOKING);\r\n    }\r\n\r\n    @FXML\r\n    public void onNavHistoryClick() {\r\n        SceneNavigator.navigateTo(AppScene.PATIENT_MEDICAL_RECORD);\r\n    }\r\n\r\n    @FXML\r\n    public void onNavResultsClick() {\r\n        statusLabel.setText(\"Sectiunea Rezultate este in pregatire.\");\r\n    }\r\n\r\n    @FXML\r\n    public void onNewAppointmentClick() {\r\n        SceneNavigator.navigateTo(AppScene.APPOINTMENT_BOOKING);\r\n    }\r\n\r\n    @FXML\r\n    public void onModifyAppointmentClick() {\r\n        statusLabel.setText(\"Modificarea programarii nu este disponibila.\");\r\n    }\r\n\r\n    @FXML\r\n    public void onCancelAppointmentClick() {\r\n        statusLabel.setText(\"Anularea programarii nu este disponibila.\");\r\n    }\r\n\r\n    @FXML\r\n    public void onHistoryClick() {\r\n        SceneNavigator.navigateTo(AppScene.PATIENT_MEDICAL_RECORD);\r\n    }\r\n\r\n    @FXML\r\n    public void onLogoutClick() {\r\n        ClientSession.getInstance().setLoggedUser(null);\r\n        SceneNavigator.navigateTo(AppScene.LOGIN);\r\n    }\r\n\r\n    public void renderDashboard(PatientDashboardDTO dto) {\r\n        if (dto == null) {\r\n            setError(\"Datele nu au fost primite.\");\r\n            return;\r\n        }\r\n\r\n        setProfile(dto.getProfile());\r\n        setNextAppointment(dto.getNextAppointment());\r\n        setHistory(dto.getHistory());\r\n        setInfo(\"\");\r\n    }\r\n\r\n    public void setBusy(boolean busy) {\r\n        // optional placeholder if needed\r\n    }\r\n\r\n    public void setInfo(String msg) {\r\n        statusLabel.setText(msg == null ? \"\" : msg);\r\n        statusLabel.setStyle(\"-fx-text-fill: #64748b;\");\r\n    }\r\n\r\n    public void setError(String msg) {\r\n        statusLabel.setText(msg == null ? \"\" : msg);\r\n        statusLabel.setStyle(\"-fx-text-fill: red;\");\r\n    }\r\n\r\n    private void renderUserHeader(UserDTO user) {\r\n        if (user == null) {\r\n            userNameLabel.setText(\"User\");\r\n            roleLabel.setText(\"Pacient\");\r\n            initialsLabel.setText(\"U\");\r\n            welcomeLabel.setText(\"Buna ziua!\");\r\n            return;\r\n        }\r\n        userNameLabel.setText(user.getFullName());\r\n        roleLabel.setText(user.getRole());\r\n        initialsLabel.setText(initials(user.getFullName()));\r\n        welcomeLabel.setText(\"Buna ziua, \" + user.getFirstName() + \"!\");\r\n    }\r\n\r\n    private void setProfile(PatientProfileDTO profile) {\r\n        if (profile == null) {\r\n            bloodTypeLabel.setText(\"-\");\r\n            weightLabel.setText(\"-\");\r\n            heightLabel.setText(\"-\");\r\n            allergiesPane.getChildren().clear();\r\n            conditionsPane.getChildren().clear();\r\n            return;\r\n        }\r\n\r\n        bloodTypeLabel.setText(emptyOrDash(profile.getBloodType()));\r\n        weightLabel.setText(profile.getWeightKg() == null ? \"-\" : formatNumber(profile.getWeightKg()) + \" kg\");\r\n        heightLabel.setText(profile.getHeightCm() == null ? \"-\" : formatNumber(profile.getHeightCm()) + \" cm\");\r\n\r\n        renderTags(allergiesPane, profile.getAllergies(), \"tag\");\r\n        renderTags(conditionsPane, profile.getConditions(), \"tag-warning\");\r\n    }\r\n\r\n    private void setNextAppointment(AppointmentDTO appt) {\r\n        if (appt == null) {\r\n            nextDoctorName.setText(\"Nu exista programari viitoare.\");\r\n            nextDoctorSpecialization.setText(\"-\");\r\n            nextDoctorInitials.setText(\"--\");\r\n            nextDateLabel.setText(\"-\");\r\n            nextTimeLabel.setText(\"-\");\r\n            return;\r\n        }\r\n\r\n        nextDoctorName.setText(appt.getDoctorName() == null ? \"Doctor\" : appt.getDoctorName());\r\n        String spec = appt.getServiceName() == null ? \"Consultatie\" : appt.getServiceName();\r\n        nextDoctorSpecialization.setText(spec);\r\n        nextDoctorInitials.setText(initials(appt.getDoctorName()));\r\n        nextDateLabel.setText(appt.getDate() == null ? \"-\" : appt.getDate().format(DateTimeFormatter.ISO_DATE));\r\n        nextTimeLabel.setText(appt.getTime() == null ? \"-\" : appt.getTime().toString());\r\n    }\r\n\r\n    private void setHistory(List<AppointmentDTO> history) {\r\n        historyContainer.getChildren().clear();\r\n        Label hint = new Label(\"Detaliile sunt disponibile in fisa medicala.\");\r\n        hint.getStyleClass().add(\"muted-text\");\r\n        historyContainer.getChildren().add(hint);\r\n    }\r\n\r\n    private void renderTags(FlowPane pane, List<String> values, String styleClass) {\r\n        pane.getChildren().clear();\r\n        if (values == null || values.isEmpty()) {\r\n            Label empty = new Label(\"-\");\r\n            empty.getStyleClass().add(\"muted-text\");\r\n            pane.getChildren().add(empty);\r\n            return;\r\n        }\r\n        for (String value : values) {\r\n            Label tag = new Label(value);\r\n            tag.getStyleClass().add(styleClass);\r\n            pane.getChildren().add(tag);\r\n        }\r\n    }\r\n\r\n    private String emptyOrDash(String value) {\r\n        return value == null || value.isBlank() ? \"-\" : value;\r\n    }\r\n\r\n    private String formatNumber(Double value) {\r\n        if (value == null) return \"-\";\r\n        if (value == value.longValue()) {\r\n            return String.valueOf(value.longValue());\r\n        }\r\n        return String.format(java.util.Locale.US, \"%.1f\", value);\r\n    }\r\n\r\n    private String initials(String name) {\r\n        if (name == null || name.isBlank()) {\r\n            return \"U\";\r\n        }\r\n        String[] parts = name.trim().split(\"\\\\s+\");\r\n        if (parts.length == 1) {\r\n            return (\"\" + parts[0].charAt(0)).toUpperCase();\r\n        }\r\n        return (\"\" + parts[0].charAt(0) + parts[1].charAt(0)).toUpperCase();\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/Client/src/main/java/com/hospital_management/client/view/patient/PatientDashboardView.java b/Client/src/main/java/com/hospital_management/client/view/patient/PatientDashboardView.java
--- a/Client/src/main/java/com/hospital_management/client/view/patient/PatientDashboardView.java	(revision 56bdb2df2e1fee6f017ba5aa94d837f9c6939598)
+++ b/Client/src/main/java/com/hospital_management/client/view/patient/PatientDashboardView.java	(date 1767701564516)
@@ -5,10 +5,12 @@
 import com.hospital_management.client.network.ClientSession;
 import com.hospital_management.client.presenter.patient.PatientDashboardPresenter;
 import javafx.fxml.FXML;
+import javafx.geometry.Pos;
 import javafx.scene.Node;
-import javafx.scene.control.Label;
-import javafx.scene.layout.FlowPane;
-import javafx.scene.layout.VBox;
+import javafx.scene.control.*;
+import javafx.scene.layout.*;
+import javafx.util.Pair;
+import java.util.Optional;
 import shared.dto.AppointmentDTO;
 import shared.dto.PatientDashboardDTO;
 import shared.dto.PatientProfileDTO;
@@ -37,6 +39,7 @@
     @FXML private Label statusLabel;
 
     private PatientDashboardPresenter presenter;
+    private Long currentAppointmentId = null;
 
     @FXML
     public void initialize() {
@@ -73,12 +76,23 @@
 
     @FXML
     public void onModifyAppointmentClick() {
-        statusLabel.setText("Modificarea programarii nu este disponibila.");
+        if (currentAppointmentId == null) {
+            setError("Nu există o programare de modificat.");
+            return;
+        }
+
+        ClientSession.getInstance().setAppointmentToEdit(currentAppointmentId);
+
+        SceneNavigator.navigateToFresh(AppScene.APPOINTMENT_BOOKING);
     }
 
     @FXML
     public void onCancelAppointmentClick() {
-        statusLabel.setText("Anularea programarii nu este disponibila.");
+        if(currentAppointmentId == null) {
+            setError("Nu există o programare de anulat!");
+            return;
+        }
+        presenter.onCancelAppointment(currentAppointmentId);
     }
 
     @FXML
@@ -160,6 +174,8 @@
             return;
         }
 
+        this.currentAppointmentId = appt.getAppointmentId();
+
         nextDoctorName.setText(appt.getDoctorName() == null ? "Doctor" : appt.getDoctorName());
         String spec = appt.getServiceName() == null ? "Consultatie" : appt.getServiceName();
         nextDoctorSpecialization.setText(spec);
@@ -170,9 +186,40 @@
 
     private void setHistory(List<AppointmentDTO> history) {
         historyContainer.getChildren().clear();
-        Label hint = new Label("Detaliile sunt disponibile in fisa medicala.");
-        hint.getStyleClass().add("muted-text");
-        historyContainer.getChildren().add(hint);
+
+        if (history == null || history.isEmpty()) {
+            Label hint = new Label("Nu există istoric recent.");
+            hint.getStyleClass().add("muted-text");
+            historyContainer.getChildren().add(hint);
+            return;
+        }
+
+        for (AppointmentDTO appt : history) {
+            HBox row = new HBox(10);
+            row.getStyleClass().add("card"); // Sau un stil mai simplu
+            row.setAlignment(Pos.CENTER_LEFT);
+
+            Label date = new Label(appt.getDate().toString());
+            Label doctor = new Label(appt.getDoctorName());
+            Label status = new Label(appt.getStatus());
+
+            // Spacer
+            Region spacer = new Region();
+            HBox.setHgrow(spacer, Priority.ALWAYS);
+
+            row.getChildren().addAll(date, doctor, status, spacer);
+
+            // --- BUTONUL DE FEEDBACK ---
+            // Verificăm dacă statusul este DONE (sau terminat)
+            if ("DONE".equalsIgnoreCase(appt.getStatus())) {
+                Button feedbackBtn = new Button("Feedback");
+                feedbackBtn.getStyleClass().add("secondary-button"); // Stil mai mic
+                feedbackBtn.setOnAction(e -> showFeedbackDialog(appt.getAppointmentId()));
+                row.getChildren().add(feedbackBtn);
+            }
+
+            historyContainer.getChildren().add(row);
+        }
     }
 
     private void renderTags(FlowPane pane, List<String> values, String styleClass) {
@@ -212,4 +259,58 @@
         }
         return ("" + parts[0].charAt(0) + parts[1].charAt(0)).toUpperCase();
     }
+
+    private void showFeedbackDialog(long appointmentId) {
+        Dialog<Pair<Integer, String>> dialog = new Dialog<>();
+        dialog.setTitle("Feedback Consultatie");
+        dialog.setHeaderText("Cum a decurs vizita la medic?");
+
+        // Butoanele standard (Trimite / Anuleaza)
+        ButtonType loginButtonType = new ButtonType("Trimite", ButtonBar.ButtonData.OK_DONE);
+        dialog.getDialogPane().getButtonTypes().addAll(loginButtonType, ButtonType.CANCEL);
+
+        // Layout
+        GridPane grid = new GridPane();
+        grid.setHgap(10);
+        grid.setVgap(10);
+        grid.setPadding(new javafx.geometry.Insets(20, 150, 10, 10));
+
+        // Input Rating (ComboBox 1-5)
+        ComboBox<Integer> ratingCombo = new ComboBox<>();
+        ratingCombo.getItems().addAll(5, 4, 3, 2, 1);
+        ratingCombo.setValue(5); // Default maxim :)
+
+        // Input Comentariu
+        TextArea commentArea = new TextArea();
+        commentArea.setPromptText("Scrie aici opinia ta...");
+        commentArea.setPrefRowCount(3);
+
+        grid.add(new Label("Nota:"), 0, 0);
+        grid.add(ratingCombo, 1, 0);
+        grid.add(new Label("Comentariu:"), 0, 1);
+        grid.add(commentArea, 1, 1);
+
+        dialog.getDialogPane().setContent(grid);
+
+        // Convertim rezultatul când se apasă Trimite
+        dialog.setResultConverter(dialogButton -> {
+            if (dialogButton == loginButtonType) {
+                return new Pair<>(ratingCombo.getValue(), commentArea.getText());
+            }
+            return null;
+        });
+
+        dialog.getDialogPane().getStylesheets().add(
+                getClass().getResource("/styles/patient_dashboard.css").toExternalForm()
+        );
+
+        dialog.getDialogPane().getStyleClass().add("my-dialog");
+
+        Optional<Pair<Integer, String>> result = dialog.showAndWait();
+
+        result.ifPresent(feedback -> {
+            // AICI APELĂM PRESENTER-UL
+            presenter.onSendFeedback(appointmentId, feedback.getKey(), feedback.getValue());
+        });
+    }
 }
Index: Client/src/main/java/com/hospital_management/client/network/ClientSession.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.hospital_management.client.network;\r\n\r\nimport shared.dto.UserDTO;\r\n\r\npublic class ClientSession {\r\n    private static ClientSession instance;\r\n    private HospitalClient client;\r\n    private UserDTO loggedUser;\r\n\r\n    private ClientSession() {\r\n        try {\r\n            // Ne conectăm la localhost, port 5555 (unde rulează ServerConsole)\r\n            client = new HospitalClient(\"localhost\", 5555);\r\n        } catch (Exception e) {\r\n            System.err.println(\"Nu ma pot conecta la server! Verifică dacă ServerConsole rulează.\");\r\n        }\r\n    }\r\n\r\n    public static synchronized ClientSession getInstance() {\r\n        if (instance == null) {\r\n            instance = new ClientSession();\r\n        }\r\n        return instance;\r\n    }\r\n\r\n    public HospitalClient getClient() {\r\n        return client;\r\n    }\r\n\r\n    public boolean isConnected() {\r\n        return client != null && client.isConnected();\r\n    }\r\n\r\n    public synchronized boolean ensureConnected() {\r\n        if (isConnected()) {\r\n            return true;\r\n        }\r\n        try {\r\n            client = new HospitalClient(\"localhost\", 5555);\r\n            return true;\r\n        } catch (Exception e) {\r\n            System.err.println(\"Nu ma pot conecta la server! Verifica daca ServerConsole ruleaza.\");\r\n            return false;\r\n        }\r\n    }\r\n\r\n    public UserDTO getLoggedUser() { return loggedUser; }\r\n    public void setLoggedUser(UserDTO loggedUser) { this.loggedUser = loggedUser; }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/Client/src/main/java/com/hospital_management/client/network/ClientSession.java b/Client/src/main/java/com/hospital_management/client/network/ClientSession.java
--- a/Client/src/main/java/com/hospital_management/client/network/ClientSession.java	(revision 56bdb2df2e1fee6f017ba5aa94d837f9c6939598)
+++ b/Client/src/main/java/com/hospital_management/client/network/ClientSession.java	(date 1767701564514)
@@ -7,6 +7,8 @@
     private HospitalClient client;
     private UserDTO loggedUser;
 
+    private Long appointmentIdToEdit = null;
+
     private ClientSession() {
         try {
             // Ne conectăm la localhost, port 5555 (unde rulează ServerConsole)
@@ -46,4 +48,16 @@
 
     public UserDTO getLoggedUser() { return loggedUser; }
     public void setLoggedUser(UserDTO loggedUser) { this.loggedUser = loggedUser; }
+
+    public void setAppointmentToEdit(Long id) {
+        this.appointmentIdToEdit = id;
+    }
+
+    public Long getAppointmentToEdit() {
+        return appointmentIdToEdit;
+    }
+
+    public void clearEditMode() {
+        this.appointmentIdToEdit = null;
+    }
 }
Index: Client/src/main/java/com/hospital_management/client/presenter/patient/AppointmentBookingPresenter.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.hospital_management.client.presenter.patient;\r\n\r\nimport com.hospital_management.client.app.AppScene;\r\nimport com.hospital_management.client.app.SceneNavigator;\r\nimport com.hospital_management.client.network.ClientSession;\r\nimport com.hospital_management.client.view.patient.AppointmentBookingView;\r\nimport javafx.application.Platform;\r\nimport shared.common.Request;\r\nimport shared.common.RequestType;\r\nimport shared.common.Response;\r\nimport shared.dto.CommandDTO;\r\nimport shared.dto.DoctorDTO;\r\nimport shared.dto.MedicalServiceDTO;\r\nimport shared.dto.SpecializationDTO;\r\nimport shared.dto.UserDTO;\r\n\r\nimport java.time.LocalDate;\r\nimport java.time.LocalTime;\r\nimport java.util.Collections;\r\nimport java.util.List;\r\nimport java.util.Objects;\r\n\r\npublic class AppointmentBookingPresenter {\r\n\r\n    private final AppointmentBookingView view;\r\n    private final SpecializationDTO allSpecializations =\r\n            new SpecializationDTO(0, \"Toate specializarile\");\r\n\r\n    private List<DoctorDTO> doctors = Collections.emptyList();\r\n    private List<SpecializationDTO> specializations = Collections.emptyList();\r\n    private List<MedicalServiceDTO> services = Collections.emptyList();\r\n    private List<CommandDTO.Action> pendingActions = Collections.emptyList();\r\n    private CommandDTO.Action currentAction;\r\n    private boolean initialLoading = false;\r\n\r\n    private SpecializationDTO selectedSpecialization;\r\n    private DoctorDTO selectedDoctor;\r\n    private MedicalServiceDTO selectedService;\r\n    private LocalDate selectedDate;\r\n    private LocalTime selectedTime;\r\n\r\n    public AppointmentBookingPresenter(AppointmentBookingView view) {\r\n        this.view = view;\r\n    }\r\n\r\n    public void loadInitialData() {\r\n        if (!ClientSession.getInstance().ensureConnected()) {\r\n            view.setError(\"Nu exista conexiune la server!\");\r\n            return;\r\n        }\r\n        initialLoading = true;\r\n        pendingActions = List.of(\r\n                CommandDTO.Action.GET_SPECIALIZATIONS,\r\n                CommandDTO.Action.GET_DOCTORS,\r\n                CommandDTO.Action.GET_MEDICAL_SERVICES\r\n        );\r\n        view.setBusy(true);\r\n        view.setInfo(\"Se incarca datele...\");\r\n        sendNext();\r\n    }\r\n\r\n    public void onSpecializationSelected(SpecializationDTO specialization) {\r\n        selectedSpecialization = specialization;\r\n        if (initialLoading) {\r\n            updateSummary();\r\n            return;\r\n        }\r\n        List<DoctorDTO> filtered = filterDoctors(specialization);\r\n        view.setDoctors(filtered);\r\n        selectedDoctor = null;\r\n        selectedTime = null;\r\n        view.setSelectedTime(null);\r\n        loadAvailableSlots();\r\n        updateSummary();\r\n    }\r\n\r\n    public void onDoctorSelected(DoctorDTO doctor) {\r\n        selectedDoctor = doctor;\r\n        if (initialLoading) {\r\n            updateSummary();\r\n            return;\r\n        }\r\n        selectedTime = null;\r\n        view.setSelectedTime(null);\r\n        loadAvailableSlots();\r\n        updateSummary();\r\n    }\r\n\r\n    public void onServiceSelected(MedicalServiceDTO service) {\r\n        selectedService = service;\r\n        if (initialLoading) {\r\n            updateSummary();\r\n            return;\r\n        }\r\n        updateSummary();\r\n    }\r\n\r\n    public void onDateSelected(LocalDate date) {\r\n        selectedDate = date;\r\n        if (initialLoading) {\r\n            updateSummary();\r\n            return;\r\n        }\r\n        selectedTime = null;\r\n        view.setSelectedTime(null);\r\n        loadAvailableSlots();\r\n        updateSummary();\r\n    }\r\n\r\n    public void onTimeSelected(LocalTime time) {\r\n        selectedTime = time;\r\n        view.setSelectedTime(time);\r\n        updateSummary();\r\n    }\r\n\r\n    public void onBook() {\r\n        UserDTO user = ClientSession.getInstance().getLoggedUser();\r\n        if (user == null) {\r\n            view.setError(\"Utilizator invalid.\");\r\n            return;\r\n        }\r\n        if (user.getPatientId() == null) {\r\n            view.setError(\"Profil pacient lipsa.\");\r\n            return;\r\n        }\r\n        if (selectedDoctor == null || selectedDate == null || selectedTime == null) {\r\n            view.setError(\"Selecteaza medicul, data si ora.\");\r\n            return;\r\n        }\r\n\r\n        CommandDTO cmd = new CommandDTO(CommandDTO.Action.BOOK_APPOINTMENT, user.getUserId())\r\n                .put(\"patientId\", user.getPatientId())\r\n                .put(\"doctorId\", selectedDoctor.getDoctorId())\r\n                .put(\"date\", selectedDate)\r\n                .put(\"time\", selectedTime);\r\n\r\n        if (selectedService != null) {\r\n            cmd.put(\"serviceId\", selectedService.getServiceId());\r\n        }\r\n\r\n        Request req = new Request(cmd);\r\n        req.setType(RequestType.COMMAND);\r\n\r\n        currentAction = CommandDTO.Action.BOOK_APPOINTMENT;\r\n        view.setBusy(true);\r\n        view.setInfo(\"Se creeaza programarea...\");\r\n        ClientSession.getInstance().getClient().setOnResponseReceived(this::handleResponse);\r\n        ClientSession.getInstance().getClient().sendRequest(req);\r\n    }\r\n\r\n    private void sendNext() {\r\n        if (pendingActions.isEmpty()) {\r\n            view.setBusy(false);\r\n            view.setInfo(\"\");\r\n            initialLoading = false;\r\n            return;\r\n        }\r\n\r\n        currentAction = pendingActions.get(0);\r\n        pendingActions = pendingActions.subList(1, pendingActions.size());\r\n\r\n        CommandDTO cmd = new CommandDTO(currentAction);\r\n        Request req = new Request(cmd);\r\n        req.setType(RequestType.COMMAND);\r\n\r\n        ClientSession.getInstance().getClient().setOnResponseReceived(this::handleResponse);\r\n        ClientSession.getInstance().getClient().sendRequest(req);\r\n    }\r\n\r\n    private void handleResponse(Response response) {\r\n        Platform.runLater(() -> {\r\n            if (response.getStatus() != Response.Status.OK) {\r\n                view.setBusy(false);\r\n                view.setError(\"Eroare: \" + response.getMessage());\r\n                return;\r\n            }\r\n\r\n            switch (currentAction) {\r\n                case GET_SPECIALIZATIONS -> {\r\n                    specializations = castList(response.getData());\r\n                    view.setSpecializations(specializations, allSpecializations);\r\n                    selectedSpecialization = allSpecializations;\r\n                }\r\n                case GET_DOCTORS -> {\r\n                    doctors = castList(response.getData());\r\n                    view.setDoctors(doctors);\r\n                }\r\n                case GET_MEDICAL_SERVICES -> {\r\n                    services = castList(response.getData());\r\n                    view.setServices(services);\r\n                }\r\n                case GET_AVAILABLE_SLOTS -> {\r\n                    List<LocalTime> times = castList(response.getData());\r\n                    view.setAvailableTimes(times);\r\n                    view.setBusy(false);\r\n                    view.setInfo(\"\");\r\n                    return;\r\n                }\r\n                case BOOK_APPOINTMENT -> {\r\n                    view.setBusy(false);\r\n                    view.setInfo(\"Programare creata cu succes.\");\r\n                    SceneNavigator.navigateTo(AppScene.PATIENT_DASHBOARD);\r\n                    return;\r\n                }\r\n                default -> view.setInfo(\"Raspuns primit.\");\r\n            }\r\n\r\n            sendNext();\r\n        });\r\n    }\r\n\r\n    private void loadAvailableSlots() {\r\n        if (initialLoading) {\r\n            return;\r\n        }\r\n        if (selectedDoctor == null || selectedDate == null) {\r\n            view.setAvailableTimes(Collections.emptyList());\r\n            return;\r\n        }\r\n\r\n        CommandDTO cmd = new CommandDTO(CommandDTO.Action.GET_AVAILABLE_SLOTS)\r\n                .put(\"doctorId\", selectedDoctor.getDoctorId())\r\n                .put(\"date\", selectedDate);\r\n\r\n        Request req = new Request(cmd);\r\n        req.setType(RequestType.COMMAND);\r\n\r\n        currentAction = CommandDTO.Action.GET_AVAILABLE_SLOTS;\r\n        view.setBusy(true);\r\n        view.setInfo(\"Se incarca orele disponibile...\");\r\n        ClientSession.getInstance().getClient().setOnResponseReceived(this::handleResponse);\r\n        ClientSession.getInstance().getClient().sendRequest(req);\r\n    }\r\n\r\n    private List<DoctorDTO> filterDoctors(SpecializationDTO spec) {\r\n        if (spec == null || spec.getSpecializationId() == 0) {\r\n            return doctors;\r\n        }\r\n        return doctors.stream()\r\n                .filter(d -> Objects.equals(d.getSpecializationName(), spec.getName()))\r\n                .toList();\r\n    }\r\n\r\n    private void updateSummary() {\r\n        String doctorName = selectedDoctor == null ? null : selectedDoctor.getFullName();\r\n        String specName = null;\r\n        if (selectedDoctor != null) {\r\n            specName = selectedDoctor.getSpecializationName();\r\n        } else if (selectedSpecialization != null && selectedSpecialization.getSpecializationId() != 0) {\r\n            specName = selectedSpecialization.getName();\r\n        }\r\n        String serviceName = selectedService == null ? null : selectedService.getName();\r\n        String price = selectedService == null || selectedService.getPrice() == null\r\n                ? null\r\n                : selectedService.getPrice().toPlainString() + \" RON\";\r\n\r\n        view.updateSummary(doctorName, specName, selectedDate, selectedTime, serviceName, price);\r\n    }\r\n\r\n    @SuppressWarnings(\"unchecked\")\r\n    private <T> List<T> castList(Object data) {\r\n        if (data instanceof List<?>) {\r\n            return (List<T>) data;\r\n        }\r\n        return Collections.emptyList();\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/Client/src/main/java/com/hospital_management/client/presenter/patient/AppointmentBookingPresenter.java b/Client/src/main/java/com/hospital_management/client/presenter/patient/AppointmentBookingPresenter.java
--- a/Client/src/main/java/com/hospital_management/client/presenter/patient/AppointmentBookingPresenter.java	(revision 56bdb2df2e1fee6f017ba5aa94d837f9c6939598)
+++ b/Client/src/main/java/com/hospital_management/client/presenter/patient/AppointmentBookingPresenter.java	(date 1767701564515)
@@ -128,12 +128,32 @@
             return;
         }
 
-        CommandDTO cmd = new CommandDTO(CommandDTO.Action.BOOK_APPOINTMENT, user.getUserId())
-                .put("patientId", user.getPatientId())
-                .put("doctorId", selectedDoctor.getDoctorId())
-                .put("date", selectedDate)
-                .put("time", selectedTime);
+        Long editId = ClientSession.getInstance().getAppointmentToEdit();
+
+        CommandDTO cmd;
+
+        if (editId != null) {
+            cmd = new CommandDTO(CommandDTO.Action.UPDATE_APPOINTMENT, user.getUserId())
+                    .put("appointmentId", editId)
+                    .put("patientId", user.getPatientId())
+                    .put("doctorId", selectedDoctor.getDoctorId())
+                    .put("date", selectedDate)
+                    .put("time", selectedTime);
+
+            view.setInfo("Se actualizează programarea...");
+            currentAction = CommandDTO.Action.UPDATE_APPOINTMENT;
+
+        } else {
+            cmd = new CommandDTO(CommandDTO.Action.BOOK_APPOINTMENT, user.getUserId())
+                    .put("patientId", user.getPatientId())
+                    .put("doctorId", selectedDoctor.getDoctorId())
+                    .put("date", selectedDate)
+                    .put("time", selectedTime);
 
+            view.setInfo("Se creează programarea...");
+            currentAction = CommandDTO.Action.BOOK_APPOINTMENT;
+        }
+
         if (selectedService != null) {
             cmd.put("serviceId", selectedService.getServiceId());
         }
@@ -199,7 +219,16 @@
                 case BOOK_APPOINTMENT -> {
                     view.setBusy(false);
                     view.setInfo("Programare creata cu succes.");
-                    SceneNavigator.navigateTo(AppScene.PATIENT_DASHBOARD);
+                    SceneNavigator.navigateToFresh(AppScene.PATIENT_DASHBOARD);
+                    return;
+                }
+                case UPDATE_APPOINTMENT -> {
+                    view.setBusy(false);
+                    view.setInfo("Programare actualizata cu succes.");
+
+                    ClientSession.getInstance().clearEditMode();
+
+                    SceneNavigator.navigateToFresh(AppScene.PATIENT_DASHBOARD);
                     return;
                 }
                 default -> view.setInfo("Raspuns primit.");
Index: Server/src/main/java/server/repository/PatientRepository.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package server.repository;\r\n\r\nimport java.sql.*;\r\n\r\npublic class PatientRepository {\r\n\r\n    /**\r\n     * Creates a patient profile using its own connection.\r\n     * Returns the generated patient_id.\r\n     */\r\n    public long createPatient(long userId,\r\n                              String nationalId,\r\n                              String address,\r\n                              String phone,\r\n                              java.time.LocalDate birthDate) throws SQLException {\r\n        try (Connection conn = Repository.getConnection()) {\r\n            return createPatient(conn, userId, nationalId, address, phone, birthDate);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Creates a patient profile linked to an existing user_id.\r\n     * Returns the generated patient_id.\r\n     */\r\n    public long createPatient(Connection conn,\r\n                              long userId,\r\n                              String nationalId,\r\n                              String address,\r\n                              String phone,\r\n                              java.time.LocalDate birthDate) throws SQLException {\r\n\r\n        String sql = \"\"\"\r\n            INSERT INTO patient (user_id, national_id, address, phone, birth_date)\r\n            VALUES (?, ?, ?, ?, ?)\r\n            RETURNING patient_id\r\n            \"\"\";\r\n\r\n        try (PreparedStatement ps = conn.prepareStatement(sql)) {\r\n            ps.setLong(1, userId);\r\n            ps.setString(2, nationalId);\r\n            ps.setString(3, address);\r\n            ps.setString(4, phone);\r\n\r\n            if (birthDate != null) {\r\n                ps.setDate(5, java.sql.Date.valueOf(birthDate));\r\n            } else {\r\n                ps.setNull(5, java.sql.Types.DATE);\r\n            }\r\n\r\n            try (ResultSet rs = ps.executeQuery()) {\r\n                if (rs.next()) return rs.getLong(\"patient_id\");\r\n            }\r\n        }\r\n\r\n        throw new SQLException(\"Failed to create patient (no patient_id returned).\");\r\n    }\r\n\r\n    /**\r\n     * Finds patient_id by user_id.\r\n     * Returns null if not found.\r\n     */\r\n    public Long findPatientIdByUserId(long userId) throws SQLException {\r\n        String sql = \"\"\"\r\n                SELECT patient_id\r\n                FROM patient\r\n                WHERE user_id = ?\r\n                \"\"\";\r\n\r\n        try (Connection conn = Repository.getConnection();\r\n             PreparedStatement ps = conn.prepareStatement(sql)) {\r\n\r\n            ps.setLong(1, userId);\r\n\r\n            try (ResultSet rs = ps.executeQuery()) {\r\n                if (rs.next()) {\r\n                    return rs.getLong(\"patient_id\");\r\n                }\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/Server/src/main/java/server/repository/PatientRepository.java b/Server/src/main/java/server/repository/PatientRepository.java
--- a/Server/src/main/java/server/repository/PatientRepository.java	(revision 56bdb2df2e1fee6f017ba5aa94d837f9c6939598)
+++ b/Server/src/main/java/server/repository/PatientRepository.java	(date 1767701564519)
@@ -37,7 +37,7 @@
 
         try (PreparedStatement ps = conn.prepareStatement(sql)) {
             ps.setLong(1, userId);
-            ps.setString(2, nationalId);
+            ps.setString(2, (nationalId == null) ? "" : nationalId); //if nationalId is null, send empty string
             ps.setString(3, address);
             ps.setString(4, phone);
 
Index: Server/src/main/java/server/repository/AppointmentRepository.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package server.repository;\r\n\r\nimport server.model.AppointmentStatus;\r\n\r\nimport java.sql.*;\r\nimport java.time.LocalDate;\r\nimport java.time.LocalTime;\r\n\r\npublic class AppointmentRepository {\r\n\r\n    private static final String DB_STATUS_CANCELED = \"CANCELLED\";\r\n\r\n    private String toDbStatus(AppointmentStatus status) {\r\n        if (status == null) {\r\n            return null;\r\n        }\r\n        if (status == AppointmentStatus.CANCELED) {\r\n            return DB_STATUS_CANCELED;\r\n        }\r\n        return status.name();\r\n    }\r\n\r\n    public boolean isSlotAvailable(long doctorId, LocalDate date, LocalTime time) throws SQLException {\r\n        String sql = \"\"\"\r\n                SELECT COUNT(*) FROM appointment\r\n                WHERE doctor_id = ? \r\n                  AND appointment_date = ? \r\n                  AND appointment_time = ?\r\n                  AND status::text NOT IN ('CANCELED', 'CANCELLED')\r\n                \"\"\";\r\n\r\n        try (Connection conn = Repository.getConnection();\r\n             PreparedStatement ps = conn.prepareStatement(sql)) {\r\n\r\n            ps.setLong(1, doctorId);\r\n            ps.setDate(2, Date.valueOf(date));\r\n            ps.setTime(3, Time.valueOf(time));\r\n\r\n            try (ResultSet rs = ps.executeQuery()) {\r\n                if (rs.next()) {\r\n                    return rs.getInt(1) == 0;\r\n                }\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    public long createAppointment(long patientId, long doctorId, long serviceId,\r\n                                  LocalDate date, LocalTime time, AppointmentStatus status) throws SQLException {\r\n        String sql = \"\"\"\r\n                INSERT INTO appointment (patient_id, doctor_id, service_id, appointment_date, appointment_time, status, created_at)\r\n                VALUES (?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP)\r\n                RETURNING appointment_id\r\n                \"\"\";\r\n\r\n        try (Connection conn = Repository.getConnection();\r\n             PreparedStatement ps = conn.prepareStatement(sql)) {\r\n\r\n            ps.setLong(1, patientId);\r\n            ps.setLong(2, doctorId);\r\n            if (serviceId > 0) ps.setLong(3, serviceId); else ps.setNull(3, Types.BIGINT);\r\n            ps.setDate(4, Date.valueOf(date));\r\n            ps.setTime(5, Time.valueOf(time));\r\n            ps.setString(6, toDbStatus(status));\r\n\r\n            try (ResultSet rs = ps.executeQuery()) {\r\n                if (rs.next()) return rs.getLong(\"appointment_id\");\r\n            }\r\n        }\r\n        throw new SQLException(\"Failed to create appointment\");\r\n    }\r\n\r\n    public boolean updateStatus(long appointmentId, AppointmentStatus status) throws SQLException {\r\n        String sql = \"UPDATE appointment SET status = ?, updated_at = CURRENT_TIMESTAMP WHERE appointment_id = ?\";\r\n\r\n        try (Connection conn = Repository.getConnection();\r\n             PreparedStatement ps = conn.prepareStatement(sql)) {\r\n\r\n            ps.setString(1, toDbStatus(status));\r\n            ps.setLong(2, appointmentId);\r\n\r\n            return ps.executeUpdate() > 0;\r\n        }\r\n    }\r\n\r\n    public java.util.List<LocalTime> findBookedTimes(long doctorId, LocalDate date) throws SQLException {\r\n        String sql = \"\"\"\r\n                SELECT appointment_time\r\n                FROM appointment\r\n                WHERE doctor_id = ?\r\n                  AND appointment_date = ?\r\n                  AND status::text NOT IN ('CANCELED', 'CANCELLED')\r\n                \"\"\";\r\n\r\n        java.util.List<LocalTime> result = new java.util.ArrayList<>();\r\n        try (Connection conn = Repository.getConnection();\r\n             PreparedStatement ps = conn.prepareStatement(sql)) {\r\n            ps.setLong(1, doctorId);\r\n            ps.setDate(2, Date.valueOf(date));\r\n            try (ResultSet rs = ps.executeQuery()) {\r\n                while (rs.next()) {\r\n                    Time time = rs.getTime(\"appointment_time\");\r\n                    if (time != null) {\r\n                        result.add(time.toLocalTime());\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    public shared.dto.AppointmentDTO findNextByPatientId(long patientId) throws SQLException {\r\n        String sql = \"\"\"\r\n                SELECT a.appointment_id,\r\n                       a.patient_id,\r\n                       a.doctor_id,\r\n                       a.appointment_date,\r\n                       a.appointment_time,\r\n                       a.status,\r\n                       u.first_name || ' ' || u.last_name AS doctor_name,\r\n                       COALESCE(s.name, sp.name) AS service_name\r\n                FROM appointment a\r\n                JOIN doctor d ON d.doctor_id = a.doctor_id\r\n                JOIN \"user\" u ON u.user_id = d.user_id\r\n                LEFT JOIN medical_service s ON s.service_id = a.service_id\r\n                LEFT JOIN specialization sp ON sp.specialization_id = d.specialization_id\r\n                WHERE a.patient_id = ?\r\n                  AND a.appointment_date >= CURRENT_DATE\r\n                  AND a.status::text NOT IN ('CANCELED', 'CANCELLED')\r\n                ORDER BY a.appointment_date, a.appointment_time\r\n                LIMIT 1\r\n                \"\"\";\r\n\r\n        try (Connection conn = Repository.getConnection();\r\n             PreparedStatement ps = conn.prepareStatement(sql)) {\r\n            ps.setLong(1, patientId);\r\n            try (ResultSet rs = ps.executeQuery()) {\r\n                if (rs.next()) {\r\n                    return new shared.dto.AppointmentDTO(\r\n                            rs.getLong(\"appointment_id\"),\r\n                            rs.getLong(\"patient_id\"),\r\n                            null,\r\n                            rs.getLong(\"doctor_id\"),\r\n                            rs.getString(\"doctor_name\"),\r\n                            rs.getString(\"service_name\"),\r\n                            rs.getDate(\"appointment_date\").toLocalDate(),\r\n                            rs.getTime(\"appointment_time\").toLocalTime(),\r\n                            rs.getString(\"status\")\r\n                    );\r\n                }\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    public java.util.List<shared.dto.AppointmentDTO> findHistoryByPatientId(long patientId, int limit)\r\n            throws SQLException {\r\n        String sql = \"\"\"\r\n                SELECT a.appointment_id,\r\n                       a.patient_id,\r\n                       a.doctor_id,\r\n                       a.appointment_date,\r\n                       a.appointment_time,\r\n                       a.status,\r\n                       u.first_name || ' ' || u.last_name AS doctor_name,\r\n                       COALESCE(s.name, sp.name) AS service_name\r\n                FROM appointment a\r\n                JOIN doctor d ON d.doctor_id = a.doctor_id\r\n                JOIN \"user\" u ON u.user_id = d.user_id\r\n                LEFT JOIN medical_service s ON s.service_id = a.service_id\r\n                LEFT JOIN specialization sp ON sp.specialization_id = d.specialization_id\r\n                WHERE a.patient_id = ?\r\n                  AND a.appointment_date < CURRENT_DATE\r\n                ORDER BY a.appointment_date DESC, a.appointment_time DESC\r\n                LIMIT ?\r\n                \"\"\";\r\n\r\n        java.util.List<shared.dto.AppointmentDTO> result = new java.util.ArrayList<>();\r\n        try (Connection conn = Repository.getConnection();\r\n             PreparedStatement ps = conn.prepareStatement(sql)) {\r\n            ps.setLong(1, patientId);\r\n            ps.setInt(2, limit);\r\n            try (ResultSet rs = ps.executeQuery()) {\r\n                while (rs.next()) {\r\n                    result.add(new shared.dto.AppointmentDTO(\r\n                            rs.getLong(\"appointment_id\"),\r\n                            rs.getLong(\"patient_id\"),\r\n                            null,\r\n                            rs.getLong(\"doctor_id\"),\r\n                            rs.getString(\"doctor_name\"),\r\n                            rs.getString(\"service_name\"),\r\n                            rs.getDate(\"appointment_date\").toLocalDate(),\r\n                            rs.getTime(\"appointment_time\").toLocalTime(),\r\n                            rs.getString(\"status\")\r\n                    ));\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/Server/src/main/java/server/repository/AppointmentRepository.java b/Server/src/main/java/server/repository/AppointmentRepository.java
--- a/Server/src/main/java/server/repository/AppointmentRepository.java	(revision 56bdb2df2e1fee6f017ba5aa94d837f9c6939598)
+++ b/Server/src/main/java/server/repository/AppointmentRepository.java	(date 1767701564518)
@@ -49,7 +49,7 @@
                                   LocalDate date, LocalTime time, AppointmentStatus status) throws SQLException {
         String sql = """
                 INSERT INTO appointment (patient_id, doctor_id, service_id, appointment_date, appointment_time, status, created_at)
-                VALUES (?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP)
+                VALUES (?, ?, ?, ?, ?, ?::appointment_status, CURRENT_TIMESTAMP)
                 RETURNING appointment_id
                 """;
 
@@ -70,8 +70,33 @@
         throw new SQLException("Failed to create appointment");
     }
 
+    public boolean updateAppointment(long appointmentId, long doctorId, Long serviceId,
+                                     LocalDate date, LocalTime time) throws SQLException {
+        String sql = """
+            UPDATE appointment
+            SET doctor_id = ?,
+                service_id = ?,
+                appointment_date = ?,
+                appointment_time = ?,
+                updated_at = CURRENT_TIMESTAMP
+            WHERE appointment_id = ?
+            """;
+
+        try (Connection conn = Repository.getConnection();
+             PreparedStatement ps = conn.prepareStatement(sql)) {
+
+            ps.setLong(1, doctorId);
+            if (serviceId != null) ps.setLong(2, serviceId); else ps.setNull(2, Types.BIGINT);
+            ps.setDate(3, Date.valueOf(date));
+            ps.setTime(4, Time.valueOf(time));
+            ps.setLong(5, appointmentId);
+
+            return ps.executeUpdate() > 0;
+        }
+    }
+
     public boolean updateStatus(long appointmentId, AppointmentStatus status) throws SQLException {
-        String sql = "UPDATE appointment SET status = ?, updated_at = CURRENT_TIMESTAMP WHERE appointment_id = ?";
+        String sql = "UPDATE appointment SET status = ?::appointment_status, updated_at = CURRENT_TIMESTAMP WHERE appointment_id = ?";
 
         try (Connection conn = Repository.getConnection();
              PreparedStatement ps = conn.prepareStatement(sql)) {
Index: Server/src/main/java/server/controller/AppointmentController.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package server.controller;\r\n\r\nimport shared.common.Response;\r\nimport shared.dto.CommandDTO;\r\nimport shared.dto.DoctorScheduleDTO;\r\nimport server.repository.AppointmentRepository;\r\nimport server.repository.DoctorRepository;\r\nimport server.model.AppointmentStatus;\r\n\r\nimport java.time.LocalDate;\r\nimport java.time.LocalTime;\r\nimport java.util.ArrayList;\r\nimport java.util.HashSet;\r\nimport java.util.List;\r\nimport java.util.Set;\r\n\r\npublic class AppointmentController {\r\n\r\n    private final AppointmentRepository appointmentRepository;\r\n    private final DoctorRepository doctorRepository;\r\n    private static final int SLOT_MINUTES = 30;\r\n\r\n    public AppointmentController() {\r\n        this.appointmentRepository = new AppointmentRepository();\r\n        this.doctorRepository = new DoctorRepository();\r\n    }\r\n\r\n    public Response bookAppointment(CommandDTO command) {\r\n        Long patientId = command.getLong(\"patientId\");\r\n        Long doctorId = command.getLong(\"doctorId\");\r\n        Long serviceId = command.getLong(\"serviceId\"); // Poate fi null dacă nu e selectat\r\n        LocalDate date = command.getDate(\"date\"); // Asigură-te că CommandDTO știe să extragă LocalDate\r\n        LocalTime time = (LocalTime) command.getData().get(\"time\"); // Sau un helper getTime()\r\n\r\n        if (patientId == null || doctorId == null || date == null || time == null) {\r\n            return Response.error(\"VALIDATION_ERROR\", \"Missing appointment details\");\r\n        }\r\n\r\n        try {\r\n            // Verificăm disponibilitatea (opțional, dar recomandat)\r\n            boolean isFree = appointmentRepository.isSlotAvailable(doctorId, date, time);\r\n            if (!isFree) {\r\n                return Response.error(\"SLOT_TAKEN\", \"The selected slot is no longer available.\");\r\n            }\r\n\r\n            // Inserare în DB\r\n            long appointmentId = appointmentRepository.createAppointment(\r\n                    patientId, doctorId, serviceId != null ? serviceId : 0, date, time, AppointmentStatus.PENDING\r\n            );\r\n\r\n            return Response.okMessage(\"Appointment requested successfully. ID: \" + appointmentId);\r\n\r\n        } catch (Exception e) {\r\n            return Response.error(\"DB_ERROR\", \"Booking failed: \" + e.getMessage());\r\n        }\r\n    }\r\n\r\n    public Response cancelAppointment(CommandDTO command) {\r\n        Long appointmentId = command.getLong(\"appointmentId\");\r\n\r\n        try {\r\n            boolean updated = appointmentRepository.updateStatus(appointmentId, AppointmentStatus.CANCELED);\r\n            if (updated) return Response.okMessage(\"Appointment canceled\");\r\n            else return Response.error(\"NOT_FOUND\", \"Appointment not found\");\r\n        } catch (Exception e) {\r\n            return Response.error(\"DB_ERROR\", e.getMessage());\r\n        }\r\n    }\r\n\r\n    public Response approveAppointment(CommandDTO command) {\r\n        Long appointmentId = command.getLong(\"appointmentId\");\r\n        try {\r\n            boolean updated = appointmentRepository.updateStatus(appointmentId, AppointmentStatus.CONFIRMED);\r\n            if (updated) return Response.okMessage(\"Appointment confirmed\");\r\n            else return Response.error(\"NOT_FOUND\", \"Appointment not found\");\r\n        } catch (Exception e) {\r\n            return Response.error(\"DB_ERROR\", e.getMessage());\r\n        }\r\n    }\r\n\r\n    public Response markAppointmentDone(CommandDTO command) {\r\n        Long appointmentId = command.getLong(\"appointmentId\");\r\n        try {\r\n            boolean updated = appointmentRepository.updateStatus(appointmentId, AppointmentStatus.DONE);\r\n            if (updated) return Response.okMessage(\"Appointment marked as done\");\r\n            else return Response.error(\"NOT_FOUND\", \"Appointment not found\");\r\n        } catch (Exception e) {\r\n            return Response.error(\"DB_ERROR\", e.getMessage());\r\n        }\r\n    }\r\n\r\n    public Response getAvailableSlots(CommandDTO command) {\r\n        Long doctorId = command.getLong(\"doctorId\");\r\n        LocalDate date = command.getDate(\"date\");\r\n\r\n        if (doctorId == null || date == null) {\r\n            return Response.error(\"VALIDATION_ERROR\", \"Doctor ID and date are required\");\r\n        }\r\n\r\n        try {\r\n            int dayOfWeek = date.getDayOfWeek().getValue();\r\n            List<DoctorScheduleDTO> schedule = doctorRepository.findScheduleByDoctorId(doctorId);\r\n            if (schedule.isEmpty()) {\r\n                return Response.ok(List.of());\r\n            }\r\n\r\n            Set<LocalTime> booked = new HashSet<>(appointmentRepository.findBookedTimes(doctorId, date));\r\n            List<LocalTime> available = new ArrayList<>();\r\n            LocalTime now = LocalDate.now().equals(date) ? LocalTime.now().withSecond(0).withNano(0) : null;\r\n\r\n            for (DoctorScheduleDTO slot : schedule) {\r\n                if (slot.getDayOfWeek() != dayOfWeek) {\r\n                    continue;\r\n                }\r\n                LocalTime start = slot.getStartTime();\r\n                LocalTime end = slot.getEndTime();\r\n                if (start == null || end == null) {\r\n                    continue;\r\n                }\r\n                LocalTime time = start;\r\n                while (!time.plusMinutes(SLOT_MINUTES).isAfter(end)) {\r\n                    if (!booked.contains(time)) {\r\n                        if (now == null || time.isAfter(now)) {\r\n                            available.add(time);\r\n                        }\r\n                    }\r\n                    time = time.plusMinutes(SLOT_MINUTES);\r\n                }\r\n            }\r\n\r\n            available.sort(LocalTime::compareTo);\r\n            return Response.ok(available);\r\n        } catch (Exception e) {\r\n            return Response.error(\"DB_ERROR\", e.getMessage());\r\n        }\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/Server/src/main/java/server/controller/AppointmentController.java b/Server/src/main/java/server/controller/AppointmentController.java
--- a/Server/src/main/java/server/controller/AppointmentController.java	(revision 56bdb2df2e1fee6f017ba5aa94d837f9c6939598)
+++ b/Server/src/main/java/server/controller/AppointmentController.java	(date 1767701564517)
@@ -55,6 +55,25 @@
         }
     }
 
+    public Response updateAppointment(CommandDTO command) {
+        Long appointmentId = command.getLong("appointmentId");
+        Long doctorId = command.getLong("doctorId");
+        Long serviceId = command.getLong("serviceId");
+        LocalDate date = command.getDate("date");
+        LocalTime time = (LocalTime) command.getData().get("time");
+
+        try {
+            boolean updated = appointmentRepository.updateAppointment(appointmentId, doctorId, serviceId, date, time);
+            if (updated) {
+                return Response.okMessage("Appointment updated successfully");
+            } else {
+                return Response.error("NOT_FOUND", "Appointment not found");
+            }
+        } catch (Exception e) {
+            return Response.error("DB_ERROR", e.getMessage());
+        }
+    }
+
     public Response cancelAppointment(CommandDTO command) {
         Long appointmentId = command.getLong("appointmentId");
 
Index: Client/src/main/java/com/hospital_management/client/presenter/patient/PatientDashboardPresenter.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.hospital_management.client.presenter.patient;\r\n\r\nimport com.hospital_management.client.app.SceneNavigator;\r\nimport com.hospital_management.client.app.AppScene;\r\nimport com.hospital_management.client.network.ClientSession;\r\nimport com.hospital_management.client.view.patient.PatientDashboardView;\r\nimport javafx.application.Platform;\r\nimport shared.common.Request;\r\nimport shared.common.RequestType;\r\nimport shared.common.Response;\r\nimport shared.dto.CommandDTO;\r\nimport shared.dto.PatientDashboardDTO;\r\nimport shared.dto.UserDTO;\r\n\r\npublic class PatientDashboardPresenter {\r\n\r\n    private final PatientDashboardView view;\r\n\r\n    public PatientDashboardPresenter(PatientDashboardView view) {\r\n        this.view = view;\r\n    }\r\n\r\n    public void loadDashboard() {\r\n        UserDTO user = ClientSession.getInstance().getLoggedUser();\r\n        if (user == null) {\r\n            view.setError(\"Utilizator neautentificat.\");\r\n            SceneNavigator.navigateTo(AppScene.LOGIN);\r\n            return;\r\n        }\r\n\r\n        if (!ClientSession.getInstance().ensureConnected()) {\r\n            view.setError(\"Nu exista conexiune la server!\");\r\n            return;\r\n        }\r\n\r\n        CommandDTO cmd = new CommandDTO(CommandDTO.Action.GET_PATIENT_DASHBOARD, user.getUserId());\r\n        Request req = new Request(cmd);\r\n        req.setType(RequestType.COMMAND);\r\n\r\n        view.setBusy(true);\r\n        view.setInfo(\"Se incarca datele...\");\r\n\r\n        ClientSession.getInstance().getClient().setOnResponseReceived(this::handleResponse);\r\n        ClientSession.getInstance().getClient().sendRequest(req);\r\n    }\r\n\r\n    private void handleResponse(Response response) {\r\n        Platform.runLater(() -> {\r\n            view.setBusy(false);\r\n\r\n            if (response.getStatus() != Response.Status.OK) {\r\n                view.setError(\"Eroare: \" + response.getMessage());\r\n                return;\r\n            }\r\n\r\n            PatientDashboardDTO data = (PatientDashboardDTO) response.getData();\r\n            view.renderDashboard(data);\r\n        });\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/Client/src/main/java/com/hospital_management/client/presenter/patient/PatientDashboardPresenter.java b/Client/src/main/java/com/hospital_management/client/presenter/patient/PatientDashboardPresenter.java
--- a/Client/src/main/java/com/hospital_management/client/presenter/patient/PatientDashboardPresenter.java	(revision 56bdb2df2e1fee6f017ba5aa94d837f9c6939598)
+++ b/Client/src/main/java/com/hospital_management/client/presenter/patient/PatientDashboardPresenter.java	(date 1767701564515)
@@ -57,4 +57,65 @@
             view.renderDashboard(data);
         });
     }
+
+    public void onCancelAppointment(long appointmentId) {
+        if (!ClientSession.getInstance().ensureConnected()) {
+            view.setError("Nu există conexiune la server!");
+            return;
+        }
+
+        CommandDTO cmd = new CommandDTO(CommandDTO.Action.CANCEL_APPOINTMENT)
+                .put("appointmentId", appointmentId);
+
+        Request req = new Request(cmd);
+        req.setType(RequestType.COMMAND);
+
+        view.setBusy(true);
+        view.setInfo("Se anulează programarea...");
+
+        ClientSession.getInstance().getClient().setOnResponseReceived(response -> {
+            Platform.runLater(() -> {
+                view.setBusy(false);
+                if (response.getStatus() != Response.Status.OK) {
+                    view.setError("Eroare anulare: " + response.getMessage());
+                } else {
+                    view.setInfo("Programarea a fost anulată cu succes.");
+                    // reload la dashboard
+                    loadDashboard();
+                }
+            });
+        });
+
+        ClientSession.getInstance().getClient().sendRequest(req);
+    }
+
+    public void onSendFeedback(long appointmentId, int rating, String comment) {
+        if (!ClientSession.getInstance().ensureConnected()) {
+            view.setError("Lipsă conexiune server.");
+            return;
+        }
+
+        CommandDTO cmd = new CommandDTO(CommandDTO.Action.SEND_FEEDBACK)
+                .put("appointmentId", appointmentId)
+                .put("rating", rating)
+                .put("comment", comment);
+
+        Request req = new Request(cmd);
+        req.setType(RequestType.COMMAND);
+
+        view.setInfo("Se trimite feedback-ul...");
+
+        ClientSession.getInstance().getClient().setOnResponseReceived(response -> {
+            Platform.runLater(() -> {
+                if (response.getStatus() == Response.Status.OK) {
+                    view.setInfo("Mulțumim pentru feedback!");
+                    // Opțional: Reîncarci dashboard-ul ca să ascunzi butonul de feedback pentru asta
+                } else {
+                    view.setError("Eroare: " + response.getMessage());
+                }
+            });
+        });
+
+        ClientSession.getInstance().getClient().sendRequest(req);
+    }
 }
